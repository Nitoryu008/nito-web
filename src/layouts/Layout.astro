---
import "@fontsource/zen-dots";
import "@fontsource/zen-maru-gothic";
import "@fontsource/m-plus-1p/700.css";

import "../index.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import BaseHead, {
  type Props as BaseProps,
} from "../components/BaseHead.astro";
import bgImg from "../assets/bg/textured-stripes.png";

import { css } from "../../styled-system/css";
import { getImage } from "astro:assets";
import Loading from "../components/Loading.astro";
import Background from "../components/Background.astro";

export type Props = BaseProps;

const { ...head } = Astro.props;

const body = css({
  minHeight: "100dvh",
  backgroundImage: `var(--background-url)`,
  backgroundRepeat: "repeat",
  pos: "relative",
});
const optimizedBgImg = await getImage({ src: bgImg, format: "webp" });
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead {...head} />
    <slot name="head" />
  </head>
  <body
    class={body}
    style={{ "--background-url": `url(${optimizedBgImg.src})` }}
  >
    {
      Astro.url.pathname == "/" && (
        <>
          <Loading />
          <Background />
        </>
      )
    }
    <Header />
    <main class={css({ paddingTop: "64", paddingBottom: "96" })}>
      <slot />
    </main>
    <Footer />
  </body>
</html>

<script>
  import "../onload";
</script>
